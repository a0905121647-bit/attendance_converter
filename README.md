# 出勤轉檔系統

一個功能完整的出勤管理和轉檔系統，支援 CSV 打卡檔上傳、自動工時計算、Excel 匯出，可直接匯入文中系統。

## 功能特性

### 📊 核心功能
- **多檔上傳**：支援一次上傳多個 CSV 打卡檔，自動合併處理
- **智能計算**：根據員工班別自動計算實際工時和加班時數
- **休息推估**：根據打卡間隔自動推估中間休息時間
- **Excel 匯出**：生成符合文中系統格式的 Excel 檔案
- **實時預覽**：上傳後即時顯示計算結果

### ⚙️ 計算規則
1. **起算時間**：根據員工班別設定，預設 08:00
   - 陳品璇（考勤號碼 101）：11:00 起算
   - 其他員工可自訂
   
2. **休息推估**：
   - 打卡間隔 ≥ 30 分鐘 且 ≤ 120 分鐘
   - 前一筆打卡時間落在 10:30–14:30
   - 自動判定為中間休息
   - 若推估休息 < 60 分鐘，一律計為 60 分鐘

3. **工時計算**：
   - 實際工時 = (下班時間 - 上班起算時間) - 休息分鐘
   - 加班時數 = 超過 8 小時的部分

## 安裝與本地運行

### 環境需求
- Python 3.8+
- pip

### 安裝步驟

1. **克隆或下載專案**
```bash
cd attendance_converter
```

2. **建立虛擬環境**
```bash
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate  # Windows
```

3. **安裝依賴**
```bash
pip install -r requirements.txt
```

4. **運行應用**
```bash
streamlit run app.py
```

應用將在 `http://localhost:8501` 開啟

## 使用指南

### 1. CSV 檔案格式

必要欄位：
- **姓名**：員工姓名
- **考勤號碼**：員工編號
- **日期時間**：打卡時間（支援多種格式）
- **簽到/退**：簽到或簽退

範例：
```csv
姓名,考勤號碼,日期時間,簽到/退
王小明,001,2024-01-15 08:30,簽到
王小明,001,2024-01-15 12:00,簽退
王小明,001,2024-01-15 13:00,簽到
王小明,001,2024-01-15 17:30,簽退
陳品璇,101,2024-01-15 11:15,簽到
陳品璇,101,2024-01-15 14:30,簽退
陳品璇,101,2024-01-15 15:00,簽到
陳品璇,101,2024-01-15 20:00,簽退
```

### 2. 系統設定

在側邊欄可以設定：

**預設起算時間**
- 設定所有員工的預設工作開始時間（預設 08:00）

**員工特殊設定**
- 為特定員工設定不同的起算時間
- 例如：陳品璇（101）設定為 11:00

**休息推估參數**
- 調整打卡間隔的最小/最大值（預設 30-120 分鐘）

### 3. 上傳與處理

1. 在「上傳與處理」頁籤選擇 CSV 檔案
2. 點擊「開始處理」按鈕
3. 系統自動計算工時，顯示統計資訊

### 4. 查看結果

在「預覽結果」頁籤可以：
- 按員工或日期篩選
- 查看詳細的出勤記錄
- 查看統計摘要

### 5. 匯出結果

在「下載匯出」頁籤可以：
- 下載 Excel 檔案（推薦用於文中系統匯入）
- 下載 CSV 檔案（用於其他系統）

## 輸出 Excel 規格

欄位順序（符合文中系統要求）：
1. 日期 (YYYY/MM/DD)
2. 姓名
3. 考勤號碼
4. 上班時間 (HH:MM)
5. 下班時間 (HH:MM)
6. 休息開始 (HH:MM)
7. 休息結束 (HH:MM)
8. 休息分鐘數
9. 實際工時 (小時)
10. 加班時數 (小時)
11. 備註

## 部署到外網

### 選項 1：Streamlit Cloud（推薦）

最簡單的部署方式：

1. 將專案上傳到 GitHub
2. 訪問 [Streamlit Cloud](https://streamlit.io/cloud)
3. 點擊「New app」
4. 選擇 GitHub 倉庫和 `app.py` 檔案
5. 點擊「Deploy」

### 選項 2：Render

1. 在 [Render](https://render.com) 建立帳戶
2. 連接 GitHub 倉庫
3. 建立新的 Web Service
4. 設定構建命令：`pip install -r requirements.txt`
5. 設定啟動命令：`streamlit run app.py --server.port=8501 --server.address=0.0.0.0`
6. 部署

### 選項 3：Railway

1. 在 [Railway](https://railway.app) 建立帳戶
2. 連接 GitHub 倉庫
3. Railway 將自動檢測 `Procfile` 並部署
4. 應用將在 Railway 分配的 URL 上運行

### 選項 4：Heroku

1. 在 [Heroku](https://www.heroku.com) 建立帳戶
2. 安裝 Heroku CLI
3. 運行以下命令：
```bash
heroku login
heroku create your-app-name
git push heroku main
```

## 文件結構

```
attendance_converter/
├── app.py                      # Streamlit 主應用
├── attendance_calculator.py    # 核心計算邏輯
├── test_data.py               # 測試腳本
├── requirements.txt           # Python 依賴
├── Procfile                   # Heroku/Railway 部署配置
├── render.yaml                # Render 部署配置
├── .streamlit/
│   └── config.toml           # Streamlit 配置
├── .gitignore                # Git 忽略檔案
└── README.md                 # 本檔案
```

## 技術棧

- **前端框架**：Streamlit
- **資料處理**：Pandas
- **Excel 生成**：openpyxl
- **時間處理**：Python datetime

## 常見問題

### Q: 如何修改起算時間？
A: 在側邊欄「系統設定」中修改「預設起算時間」，或為特定員工新增特殊設定。

### Q: 如何判定為中間休息？
A: 系統根據以下條件自動判定：
- 打卡間隔 30-120 分鐘
- 前一筆打卡時間在 10:30-14:30 之間

### Q: 加班時數如何計算？
A: 實際工時超過 8 小時的部分自動計為加班時數。

### Q: 支援哪些日期時間格式？
A: 支援多種格式，包括：
- `2024-01-15 08:30`
- `2024/01/15 08:30`
- `01/15 08:30`
- 帶有「上午」「下午」的格式

### Q: 可以一次上傳多個檔案嗎？
A: 可以，系統支援多檔上傳，會自動合併處理。

## 故障排除

### 上傳失敗
- 檢查 CSV 檔案編碼（應為 UTF-8）
- 確認必要欄位存在（姓名、考勤號碼、日期時間、簽到/退）

### 計算結果不正確
- 檢查員工的起算時間設定
- 驗證打卡時間格式
- 查看備註欄位中的錯誤提示

### 部署失敗
- 確保 `requirements.txt` 中的所有依賴都正確
- 檢查部署平台的日誌輸出
- 驗證 Python 版本相容性

## 支援與反饋

如有問題或建議，請：
1. 檢查本 README 中的常見問題
2. 查看應用中的錯誤提示
3. 聯絡技術支援

## 版本歷史

### v1.0 (2024-01)
- 初始版本
- 支援 CSV 上傳和 Excel 匯出
- 自動工時計算
- 員工班別管理

## 授權

本專案為內部使用工具，版權所有。

---

**最後更新**：2024 年 1 月

**開發者**：Manus AI Team

**聯絡方式**：support@manus.im
