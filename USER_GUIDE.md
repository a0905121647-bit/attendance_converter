# 出勤轉檔系統 - 完整使用手冊

## 📋 目錄

1. [系統概述](#系統概述)
2. [快速開始](#快速開始)
3. [詳細功能說明](#詳細功能說明)
4. [計算規則詳解](#計算規則詳解)
5. [常見問題](#常見問題)
6. [故障排除](#故障排除)

---

## 系統概述

### 什麼是出勤轉檔系統？

出勤轉檔系統是一個專為公司內部設計的出勤管理工具，用於：
- 處理員工打卡資料（CSV 格式）
- 自動計算工時和加班時數
- 生成符合文中系統格式的 Excel 檔案
- 簡化出勤資料的匯入流程

### 主要優勢

✅ **自動化計算**：無需手動計算工時，系統自動完成
✅ **智能休息推估**：根據打卡模式自動判定中間休息
✅ **班別管理**：支援不同員工的不同起算時間
✅ **批量處理**：一次上傳多個檔案，自動合併
✅ **即時預覽**：上傳後立即查看計算結果
✅ **文中系統相容**：直接匯入文中系統

---

## 快速開始

### 第一步：準備 CSV 檔案

確保您的 CSV 檔案包含以下欄位：

| 欄位名稱 | 說明 | 範例 |
|---------|------|------|
| 姓名 | 員工姓名 | 王小明 |
| 考勤號碼 | 員工編號 | 001 |
| 日期時間 | 打卡時間 | 2024-01-15 08:30 |
| 簽到/退 | 簽到或簽退 | 簽到 |

**範例 CSV 內容：**
```
姓名,考勤號碼,日期時間,簽到/退
王小明,001,2024-01-15 08:30,簽到
王小明,001,2024-01-15 12:00,簽退
王小明,001,2024-01-15 13:00,簽到
王小明,001,2024-01-15 17:30,簽退
```

### 第二步：訪問系統

打開瀏覽器，訪問系統 URL：
```
https://your-app-url.streamlit.app
```

### 第三步：配置員工設定

在側邊欄「系統設定」中：

1. **設定預設起算時間**
   - 預設為 08:00
   - 如需修改，輸入新的小時和分鐘

2. **新增員工特殊設定**（如需要）
   - 例如：陳品璇（考勤號碼 101）設定為 11:00
   - 點擊「新增員工設定」按鈕

### 第四步：上傳檔案

1. 在「上傳與處理」頁籤點擊「選擇一個或多個 CSV 檔案」
2. 選擇您準備好的 CSV 檔案（可多選）
3. 點擊「開始處理」按鈕
4. 等待系統計算完成

### 第五步：查看結果

在「預覽結果」頁籤查看：
- 詳細的出勤記錄
- 按員工或日期的統計摘要

### 第六步：下載匯出

在「下載匯出」頁籤下載：
- **Excel 檔案**：推薦用於文中系統匯入
- **CSV 檔案**：用於其他系統或進一步處理

---

## 詳細功能說明

### 📤 上傳與處理

#### 檔案要求

- **格式**：CSV（逗號分隔值）
- **編碼**：UTF-8
- **大小**：建議 < 10MB
- **欄位**：必須包含姓名、考勤號碼、日期時間、簽到/退

#### 支援的日期時間格式

系統支援多種日期時間格式，包括：

| 格式 | 範例 |
|------|------|
| YYYY-MM-DD HH:MM | 2024-01-15 08:30 |
| YYYY/MM/DD HH:MM | 2024/01/15 08:30 |
| MM/DD HH:MM | 01/15 08:30 |
| 帶上午/下午 | 2024-01-15 08:30 上午 |

#### 多檔上傳

系統支援一次上傳多個 CSV 檔案：
1. 點擊「選擇一個或多個 CSV 檔案」
2. 按住 Ctrl（或 Cmd）選擇多個檔案
3. 點擊「開始處理」
4. 系統自動合併所有檔案

### 📋 預覽結果

#### 篩選功能

**按員工篩選**：
- 選擇特定員工查看其出勤記錄
- 預設顯示所有員工

**按日期篩選**：
- 選擇特定日期查看該日出勤
- 支援多日期選擇

**欄位顯示**：
- 勾選「顯示所有欄位」查看完整資訊
- 取消勾選只顯示關鍵欄位

#### 統計摘要

**按員工統計**：
- 工作日數
- 總工時
- 總加班時數

**按日期統計**：
- 出勤人數
- 日總工時
- 日總加班時數

### 📥 下載匯出

#### Excel 檔案

**推薦用途**：文中系統匯入

**包含欄位**（順序固定）：
1. 日期 (YYYY/MM/DD)
2. 姓名
3. 考勤號碼
4. 上班時間 (HH:MM)
5. 下班時間 (HH:MM)
6. 休息開始 (HH:MM)
7. 休息結束 (HH:MM)
8. 休息分鐘數
9. 實際工時 (小時)
10. 加班時數 (小時)
11. 備註

**特性**：
- 自動調整欄寬
- 格式化時間顯示
- 相容文中系統

#### CSV 檔案

**推薦用途**：其他系統或進一步分析

**特性**：
- UTF-8 編碼
- 易於導入其他應用
- 保留所有資訊

---

## 計算規則詳解

### 1. 起算時間

**定義**：員工開始計算工時的時間

**預設值**：08:00（所有員工）

**特殊設定**：
- 陳品璇（考勤號碼 101）：11:00
- 其他員工可根據需要自訂

**計算影響**：
- 早於起算時間的打卡不列入工時
- 以起算時間作為計算基準

**範例**：
```
王小明（起算時間 08:00）
- 08:30 簽到（計入）
- 12:00 簽退（計入）
- 13:00 簽到（計入）
- 17:30 簽退（計入）
工時 = (17:30 - 08:30) - 休息時間

陳品璇（起算時間 11:00）
- 11:15 簽到（計入）
- 14:30 簽退（計入）
- 15:00 簽到（計入）
- 20:00 簽退（計入）
工時 = (20:00 - 11:15) - 休息時間
```

### 2. 中間休息推估

**判定條件**（必須同時滿足）：
1. 兩筆打卡間隔 ≥ 30 分鐘
2. 兩筆打卡間隔 ≤ 120 分鐘
3. 前一筆打卡時間在 10:30 ~ 14:30 之間

**計算規則**：
- 推估休息分鐘數 = 第二筆打卡時間 - 第一筆打卡時間
- 若 < 60 分鐘，一律計為 60 分鐘
- 若 ≥ 60 分鐘，按實際間隔計算

**範例**：
```
情況 1：正常午餐休息
- 12:00 簽退
- 13:00 簽到
- 間隔：60 分鐘
- 前打卡時間：12:00（在 10:30-14:30 範圍內）
- 判定：中間休息 60 分鐘 ✓

情況 2：短休息
- 12:30 簽退
- 12:45 簽到
- 間隔：15 分鐘
- 判定：不符合 ≥ 30 分鐘條件 ✗

情況 3：長休息（推估不足 60 分鐘）
- 12:00 簽退
- 12:30 簽到
- 間隔：30 分鐘
- 前打卡時間：12:00（在 10:30-14:30 範圍內）
- 判定：中間休息，但 < 60 分鐘，計為 60 分鐘 ✓

情況 4：超時休息
- 12:00 簽退
- 14:00 簽到
- 間隔：120 分鐘
- 前打卡時間：12:00（在 10:30-14:30 範圍內）
- 判定：中間休息 120 分鐘 ✓

情況 5：超出範圍
- 14:00 簽退
- 15:00 簽到
- 間隔：60 分鐘
- 前打卡時間：14:00（不在 10:30-14:30 範圍內）
- 判定：不符合條件 ✗
```

### 3. 實際工時計算

**公式**：
```
實際工時 = (下班時間 - 上班時間) - 休息分鐘 / 60
```

**說明**：
- 下班時間：當日最後一筆打卡
- 上班時間：起算時間或第一筆有效打卡（取較晚者）
- 休息分鐘：推估的中間休息時間

**範例**：
```
王小明 (2024-01-15)
- 起算時間：08:00
- 打卡：08:30 簽到、12:00 簽退、13:00 簽到、17:30 簽退
- 上班時間：08:30（第一筆打卡）
- 下班時間：17:30（最後一筆打卡）
- 總時間：17:30 - 08:30 = 9 小時
- 中間休息：12:00-13:00 = 60 分鐘
- 實際工時：9 小時 - 1 小時 = 8 小時 ✓
```

### 4. 加班時數計算

**公式**：
```
加班時數 = 實際工時 - 8 小時（若超過 8 小時）
```

**說明**：
- 標準工時：8 小時
- 超過 8 小時的部分計為加班
- 未滿 8 小時時加班時數為 0

**範例**：
```
張三豐 (2024-01-15)
- 實際工時：11.5 小時
- 加班時數：11.5 - 8 = 3.5 小時 ✓

李小華 (2024-01-15)
- 實際工時：8.75 小時
- 加班時數：8.75 - 8 = 0.75 小時 ✓

王小明 (2024-01-15)
- 實際工時：8 小時
- 加班時數：0 小時 ✓
```

---

## 常見問題

### Q1：如何修改預設起算時間？

**A**：在側邊欄「系統設定」中：
1. 找到「預設起算時間」
2. 修改「預設小時」和「預設分鐘」
3. 新上傳的檔案將使用新的起算時間

### Q2：如何為特定員工設定不同的起算時間？

**A**：在側邊欄「系統設定」中：
1. 在「新增員工特殊設定」區塊
2. 輸入考勤號碼（如 101）
3. 設定小時和分鐘（如 11:00）
4. 點擊「新增員工設定」
5. 該員工的所有記錄將使用特殊時間

### Q3：系統如何判定中間休息？

**A**：系統自動檢查：
- 兩筆打卡間隔 30-120 分鐘
- 前一筆打卡時間在 10:30-14:30
- 同時滿足時判定為休息
- 若休息 < 60 分鐘，計為 60 分鐘

### Q4：如何修改休息推估參數？

**A**：在側邊欄「系統設定」中：
1. 找到「休息推估參數」
2. 調整「最小間隔」（預設 30 分鐘）
3. 調整「最大間隔」（預設 120 分鐘）
4. 新上傳的檔案將使用新參數

### Q5：支援哪些日期時間格式？

**A**：支援多種格式，包括：
- `2024-01-15 08:30`
- `2024/01/15 08:30`
- `01/15 08:30`
- `2024-01-15 08:30 上午`

### Q6：可以一次上傳多個檔案嗎？

**A**：可以，系統支援多檔上傳：
1. 點擊「選擇一個或多個 CSV 檔案」
2. 按 Ctrl（或 Cmd）選擇多個檔案
3. 系統自動合併處理

### Q7：Excel 檔案可以直接匯入文中系統嗎？

**A**：可以，Excel 檔案已按文中系統要求格式化：
- 欄位順序固定
- 時間格式統一
- 工時精度符合要求

### Q8：如何導出 CSV 檔案？

**A**：在「下載匯出」頁籤：
1. 點擊「下載 CSV 檔案」按鈕
2. 檔案將自動下載

### Q9：計算結果不正確怎麼辦？

**A**：檢查以下項目：
- [ ] 員工起算時間設定是否正確
- [ ] CSV 日期時間格式是否有效
- [ ] 打卡順序是否正確（簽到在簽退前）
- [ ] 是否有重複或遺漏的打卡記錄

### Q10：上傳檔案失敗怎麼辦？

**A**：檢查以下項目：
- [ ] 檔案格式是否為 CSV
- [ ] 檔案編碼是否為 UTF-8
- [ ] 是否包含所有必要欄位
- [ ] 檔案大小是否超過限制

---

## 故障排除

### 問題 1：上傳後顯示「缺少必要欄位」

**原因**：CSV 檔案缺少必要欄位或欄位名稱不匹配

**解決方案**：
1. 檢查 CSV 檔案是否包含：姓名、考勤號碼、日期時間、簽到/退
2. 確認欄位名稱拼寫正確
3. 確認檔案編碼為 UTF-8

### 問題 2：計算結果顯示「無有效打卡記錄」

**原因**：
- 日期時間格式無法識別
- 所有打卡都早於起算時間
- 沒有有效的打卡記錄

**解決方案**：
1. 檢查日期時間格式是否有效
2. 確認起算時間設定是否正確
3. 驗證 CSV 中是否有實際的打卡記錄

### 問題 3：工時計算不符合預期

**原因**：
- 起算時間設定錯誤
- 休息推估參數不適合
- 打卡記錄有誤

**解決方案**：
1. 確認員工的起算時間設定
2. 檢查是否有意外的中間休息推估
3. 查看備註欄位中的提示信息

### 問題 4：Excel 匯入文中系統失敗

**原因**：
- 欄位順序不符
- 時間格式不符
- 資料型別不符

**解決方案**：
1. 確認使用系統生成的 Excel 檔案
2. 檢查文中系統的匯入要求
3. 聯絡技術支援

### 問題 5：應用無法訪問

**原因**：
- 部署失敗
- 應用崩潰
- 網路連接問題

**解決方案**：
1. 檢查網路連接
2. 刷新頁面
3. 清除瀏覽器快取
4. 聯絡技術支援

---

## 技術支援

如需進一步協助，請：

1. **查看應用中的錯誤提示**：系統會在出現問題時顯示具體錯誤信息

2. **檢查日誌**：
   - 在應用中查看「備註」欄位
   - 檢查是否有警告或錯誤提示

3. **聯絡技術支援**：
   - 郵件：support@manus.im
   - 提供：
     - 問題描述
     - 使用的 CSV 檔案（已脫敏）
     - 錯誤截圖

---

## 版本資訊

- **版本**：1.0
- **最後更新**：2024 年 1 月
- **相容系統**：文中系統

---

**感謝使用出勤轉檔系統！**
